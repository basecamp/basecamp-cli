# Skill Benchmark Spec

Empirical test to determine: does a minimal skill add value beyond `bcq --help`?

## Hypothesis

A minimal, CLI-generated skill provides value through:
1. **Domain invariants** that models consistently get wrong
2. **Standardized packaging** for discoverability and distribution

If the skill doesn't measurably improve outcomes, we rely solely on `bcq --help`.

## Conditions

| Condition | Setup | What agent sees |
|-----------|-------|-----------------|
| **A** | bcq + generated skill | `skills/basecamp/SKILL.md` loaded, plus `bcq --help` |
| **B** | bcq only | Prompt says "use `bcq --help`", no skill file |
| **C** | raw curl + docs | No bcq, API docs only (baseline from prior benchmark) |

### Condition A: bcq + minimal skill

Agent receives:
- `skills/basecamp/SKILL.md` (generated by `bcq help --agent --format=skill`)
- Access to `bcq` CLI
- Implicit permission to run `bcq --help` for discovery

The skill provides:
- Domain invariants (bucket=project, todoset vs todolist, etc.)
- Preferred patterns (use bcq, not raw curl)
- Anti-patterns to avoid

### Condition B: bcq only

Agent receives:
- System prompt: "Use the `bcq` CLI for Basecamp operations. Run `bcq --help` for available commands."
- Access to `bcq` CLI
- No skill file, no domain invariants

This tests whether `bcq --help` is self-sufficient.

### Condition C: raw curl + docs (baseline)

Agent receives:
- Basecamp API documentation
- curl + jq tools
- No bcq

Already benchmarked separately. Included for reference.

## Tasks

Reuse tasks from `benchmarks/spec.yaml` (the existing bcq vs raw benchmark):

| Task | Tests |
|------|-------|
| 01: List todos (paginated) | Pagination handling |
| 02: Find + complete todo | Chained operations |
| 03: Create + assign todo | Person lookup, assignment |
| 04: Comment on message | Recording types |
| 05: Reorder todo | Position API |
| 06: Create list + todos | Todoset vs todolist confusion |
| 07: Recover from 429 | Error handling |
| 08: Recover from 401 | Auth refresh |
| 09: Bulk complete overdue | Filter + bulk ops |
| 10: Cross-project search | Search API |

### Key differentiator tasks

Task 06 (Create list + todos) specifically tests todoset vs todolist confusion — a domain invariant in the skill.

If Condition A outperforms B on task 06, the invariants have value.

## Metrics

| Metric | Description |
|--------|-------------|
| `success_rate` | % of tasks completed correctly |
| `error_count` | Client errors (4xx) during task |
| `invariant_violations` | Times agent made a domain error (bucket/todoset confusion) |
| `help_invocations` | Times agent ran `bcq --help` or `bcq <cmd> --help` |
| `time_to_success_ms` | Time from task start to validation pass |

## Execution

```bash
# Run A vs B comparison
./benchmarks/harness.sh --condition skill   # Condition A
./benchmarks/harness.sh --condition bcq     # Condition B

# Compare results
jq -s 'group_by(.condition) | map({
  condition: .[0].condition,
  success_rate: ([.[] | select(.success)] | length) / length,
  avg_errors: ([.[] | .metrics.error_count] | add / length)
})' benchmarks/results/*.json
```

## Decision Criteria

| Outcome | Decision |
|---------|----------|
| A > B by ≥10% success rate | Keep skill, invariants have value |
| A ≈ B (within 5%) | Drop skill, rely on `bcq --help` |
| A < B | Skill is harmful, drop it |

If skill is kept, add to installer:
```bash
# In install.sh, after bcq is installed:
bcq help --agent --format=skill > ~/.config/basecamp/skills/basecamp/SKILL.md
```

## Files

| File | Purpose |
|------|---------|
| `lib/agent_invariants.json` | Source of truth for domain invariants |
| `skills/basecamp/SKILL.md` | Generated skill (checked in as bootstrap) |
| `bcq help --agent` | Human-readable agent help |
| `bcq help --agent --format=skill` | Skill generator |
| `bcq help --agent --format=json` | Machine-readable for tooling |

## Bootstrap Strategy

The skill file is both:
1. **Static bootstrap**: Works even if bcq isn't installed yet
2. **Generated artifact**: Overwritten by installer with canonical version

This breaks the bootstrap paradox: agents can discover the skill without knowing to run `bcq help --agent`.

## Regenerating the Skill

When invariants change:
```bash
bcq help --agent --format=skill > skills/basecamp/SKILL.md
git add skills/basecamp/SKILL.md lib/agent_invariants.json
git commit -m "Update skill with new invariants"
```

The skill header includes:
```
# GENERATED by bcq X.Y.Z — do not edit
# Regenerate with: bcq help --agent --format=skill
```
